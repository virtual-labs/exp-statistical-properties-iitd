<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>Virtual Labs</title>
</head>
<body>
    <div class="flex min-h-[80vh]">
        <div class="px-6 pb-6 flex-1">
          <div class="flex max-xl:flex-col mt-5 items-center gap-x-8 gap-y-2">
              <div class="flex items-center gap-2">
                <label
                  for="impulseResponse"
                  class="text-[#2c99ce] text-sm"
                  ><span class="font-medium text-base">Impulse Response </span>(comma separated values):</label
                >
                <input
                  class="border border-black px-2 py-1 rounded-sm"
                  type="text"
                  id="impulseResponse"
                  value="0.2,0.5,0.2"
                />
              </div>
              <div class="flex items-center gap-2">
                  <label
                    for="arCoeffs"
                    class="text-[#2c99ce] text-sm"
                    ><span class="font-medium text-base">AR Coefficients</span>(comma separated values):</label
                  >
                  <input
                    class="border border-black px-2 py-1 rounded-sm"
                    type="text"
                    id="arCoeffs"
                    value="0.5,-0.3"
                  />
                </div>
          </div>
          <div class="flex max-xl:flex-col mt-4 items-center gap-x-8 gap-y-2">
              <div class="flex items-center gap-2">
                <label
                  for="maCoeffs"
                  class="text-[#2c99ce] text-sm"
                  ><span class="font-medium text-base">MA Coefficients </span>(comma separated values):</label
                >
                <input
                  class="border border-black px-2 py-1 rounded-sm"
                  type="text"
                  id="maCoeffs"
                  value="0.4,0.1"
                />
              </div>
                <div class="flex items-center gap-2">
                  <label for="inputType" class="text-[#2c99ce] font-medium"
                    >Select Input Type:</label
                  >
                  <select class="border border-black  py-1 rounded-sm" id="inputType">
                    <option value="wss">Gaussian Random Variable</option>
                    <option value="sine">Sine Wave</option>
                    <option value="impulse">Impulse Response</option>
                  </select>
                </div>
                <div id="frequencyInput" style="display: none;" class="flex items-center gap-2">
                  <label
                    for="frequency"
                    class="text-[#2c99ce] font-medium"
                    >Frequency(Hz):</label
                  >
                  <input
                    class="border border-black px-2 py-1 rounded-sm"
                    type="number"
                    id="frequency"
                    value="1"
                  />
                </div>
          </div>
          <div class="mt-2 border-t-2">
            <div class="flex justify-center mt-2">
              <button
                class="bg-blue-500 text-white rounded-md px-2 py-1"
                class="button"
                onclick="updateOutputs()"
              >
                Simulate
              </button>
            </div>
              <div class="flex justify-center items-center">
                  <div id="inputPlot" style="width: 600px; height: 400px;"></div>
              </div>
              <div class="flex max-xl:flex-col justify-center items-center">
                  <div class="flex flex-col justify-center items-center">
                    <div id="ltiOutput" style="width: 600px; height: 400px;"></div>
                    <div id="ltiStats"></div>
                  </div>
                  <div class="flex flex-col justify-center items-center">
                      <div id="arOutput" style="width: 600px; height: 400px;"></div>
                      <div id="arStats"></div>
                  </div>
              </div>
              <div class="flex max-xl:flex-col justify-center items-center">
                  <div class="flex flex-col justify-center items-center">
                    <div id="maOutput" style="width: 600px; height: 400px;"></div>
                    <div id="maStats"></div>
                  </div>
                  <div class="flex flex-col justify-center items-center">
                      <div id="armaOutput" style="width: 600px; height: 400px;"></div>
                      <div id="armaStats"></div>
                  </div>
              </div>
          </div>
        </div>
    </div>
    <script>
        // Helper functions
        function mean(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }
  
        function variance(arr) {
            const m = mean(arr);
            return arr.reduce((a, b) => a + Math.pow(b - m, 2), 0) / arr.length;
        }
  
        function autocorrelation(arr, lag) {
            const m = mean(arr);
            const n = arr.length;
            let autocorr = 0;
            for (let i = 0; i < n - lag; i++) {
                autocorr += (arr[i] - m) * (arr[i + lag] - m);
            }
            return autocorr / (n - lag);
        }
  
        // Generate WSS process using Box-Muller transform for normal distribution
        function generateWSS(n) {
            const mean = 0;
            const variance = 1;
            let wss = [];
            for (let i = 0; i < n; i++) {
                let u1 = Math.random();
                let u2 = Math.random();
                let randStdNormal = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                wss.push(mean + Math.sqrt(variance) * randStdNormal);
            }
            return wss;
        }
  
        // Generate sine wave
        function generateSine(n, frequency) {
            let sineWave = [];
            for (let i = 0; i < n; i++) {
                sineWave.push(Math.sin(2 * Math.PI * frequency * i / n));
            }
            return sineWave;
        }
  
        // Generate impulse response signal
        function generateImpulseResponse(n) {
            let impulseResponse = Array(n).fill(0);
            impulseResponse[0] = 1;
            return impulseResponse;
        }
  
        // Convolve input with impulse response for LTI system
        function convolve(input, impulseResponse) {
            const n = input.length;
            const m = impulseResponse.length;
            let output = Array(n + m - 1).fill(0);
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < m; j++) {
                    output[i + j] += input[i] * impulseResponse[j];
                }
            }
            return output;
        }
  
        // AR, MA, and ARMA systems
        function arSystem(input, coeffs) {
            let output = [...input];
            for (let i = coeffs.length; i < input.length; i++) {
                for (let j = 0; j < coeffs.length; j++) {
                    output[i] += coeffs[j] * output[i - j - 1];
                }
            }
            return output;
        }
  
        function maSystem(input, coeffs) {
            let output = [...input];
            for (let i = coeffs.length; i < input.length; i++) {
                for (let j = 0; j < coeffs.length; j++) {
                    output[i] += coeffs[j] * input[i - j];
                }
            }
            return output;
        }
  
        function armaSystem(input, arCoeffs, maCoeffs) {
            let arOutput = arSystem(input, arCoeffs);
            let output = maSystem(arOutput, maCoeffs);
            return output;
        }
  
        // Function to update plots based on current input values
        function updatePlots(input, inputType) {
            // Generate outputs based on current values
            const impulseResponse = document.getElementById("impulseResponse").value.split(',').map(Number);
            const arCoeffs = document.getElementById("arCoeffs").value.split(',').map(Number);
            const maCoeffs = document.getElementById("maCoeffs").value.split(',').map(Number);
  
            const ltiOutput = convolve(input, impulseResponse);
            const arOutput = arSystem(input, arCoeffs);
            const maOutput = maSystem(input, maCoeffs);
            const armaOutput = armaSystem(input, arCoeffs, maCoeffs);
  
            // Plotting using Plotly
            Plotly.newPlot('inputPlot', [{
                x: [...Array(input.length).keys()],
                y: input,
                type: 'scatter',
                mode: 'lines',
                name: `${inputType} Input`
            }], {
                title: `${inputType} Input`
            });
  
            Plotly.newPlot('ltiOutput', [{
                x: [...Array(ltiOutput.length).keys()],
                y: ltiOutput,
                type: 'scatter',
                mode: 'lines',
                name: 'LTI Output'
            }], {
                title: 'LTI System Output'
            });
  
            Plotly.newPlot('arOutput', [{
                x: [...Array(arOutput.length).keys()],
                y: arOutput,
                type: 'scatter',
                mode: 'lines',
                name: 'AR Output'
            }], {
                title: 'AR System Output'
            });
  
            Plotly.newPlot('maOutput', [{
                x: [...Array(maOutput.length).keys()],
                y: maOutput,
                type: 'scatter',
                mode: 'lines',
                name: 'MA Output'
            }], {
                title: 'MA System Output'
            });
  
            Plotly.newPlot('armaOutput', [{
                x: [...Array(armaOutput.length).keys()],
                y: armaOutput,
                type: 'scatter',
                mode: 'lines',
                name: 'ARMA Output'
            }], {
                title: 'ARMA System Output'
            });
  
            // Display statistical properties below each plot
            document.getElementById("ltiStats").innerHTML = `
                <h3>LTI Output Statistics</h3>
                <p>Mean: ${mean(ltiOutput)}</p>
                <p>Variance: ${variance(ltiOutput)}</p>
                <p>Autocorrelation (lag 1): ${autocorrelation(ltiOutput, 1)}</p>
            `;
  
            document.getElementById("arStats").innerHTML = `
                <h3>AR Output Statistics</h3>
                <p>Mean: ${mean(arOutput)}</p>
                <p>Variance: ${variance(arOutput)}</p>
                <p>Autocorrelation (lag 1): ${autocorrelation(arOutput, 1)}</p>
            `;
  
            document.getElementById("maStats").innerHTML = `
                <h3>MA Output Statistics</h3>
                <p>Mean: ${mean(maOutput)}</p>
                <p>Variance: ${variance(maOutput)}</p>
                <p>Autocorrelation (lag 1): ${autocorrelation(maOutput, 1)}</p>
            `;
  
            document.getElementById("armaStats").innerHTML = `
                <h3>ARMA Output Statistics</h3>
                <p>Mean: ${mean(armaOutput)}</p>
                <p>Variance: ${variance(armaOutput)}</p>
                <p>Autocorrelation (lag 1): ${autocorrelation(armaOutput, 1)}</p>
            `;
        }
  
        function updateOutputs() {
            const n = 100; // Number of samples
            const inputType = document.getElementById("inputType").value;
            let input;
  
            switch (inputType) {
                case "wss":
                    input = generateWSS(n);
                    break;
                case "sine":
                    const frequency = Number(document.getElementById("frequency").value);
                    input = generateSine(n, frequency);
                    break;
                case "impulse":
                    input = generateImpulseResponse(n);
                    break;
            }
  
            updatePlots(input, inputType);
        }
  
        document.getElementById("inputType").addEventListener("change", function() {
            const selectedInput = this.value;
            if (selectedInput === "sine") {
                document.getElementById("frequencyInput").style.display = "block";
            } else {
                document.getElementById("frequencyInput").style.display = "none";
            }
        });
    </script>
</body>
</html>